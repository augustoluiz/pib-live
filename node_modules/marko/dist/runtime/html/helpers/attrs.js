"use strict";

var complain;
var attrHelper = require("./attr");
var classAttrHelper = require("./class-attr");
var styleAttrHelper = require("./style-attr");

// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2
var invalidAttrNameCharacters = /[\s'"</=\\]/u;
var validAttrs = new Set();
var invalidAttrs = new Set();

module.exports = function attrs(arg) {
  if (typeof arg === "object") {
    var out = "";
    for (var attrName in arg) {
      if (attrName === "style") {
        out += styleAttrHelper(arg[attrName]);
      } else if (attrName === "class") {
        out += classAttrHelper(arg[attrName]);
      } else if (attrName !== "renderBody" && isValidAttrName(attrName)) {
        out += attrHelper(attrName, arg[attrName]);
      }
    }
    return out;
  } else if (typeof arg === "string") {
    return arg;
    // eslint-disable-next-line no-constant-condition
  }
  return "";
};

function isValidAttrName(attrName) {
  if (validAttrs.has(attrName)) return true;
  if (invalidAttrs.has(attrName)) return false;

  if (invalidAttrNameCharacters.test(attrName)) {
    invalidAttrs.add(attrName);
    return false;
  }

  validAttrs.add(attrName);
  return true;
}